{% load static %}
<title>{% block title %}Patient Medical History{% endblock %}</title>

{% block styles%} 
<link rel="stylesheet" href="{% static 'css/patient_medical_history_style.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    #title{
        margin-top: 20px;
        margin-bottom: 10px;
    }
    #other-side{
        width: 81%;
        height: 100%;
        
        position: absolute;
        left: 18%;
        top : 0%;
        display: flex;
        flex-direction: column; /* Ensure child elements stack vertically */
    }
    #menu-history-bar {
        background-color: #f4f4f4;
        padding: 5px;
        border-radius: 5px;
        margin-right: 10px;
        border: 1px solid #ccc;
        width: fit-content;
    }
    
    #menu-history-bar ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
        display: flex; /* Make the menu items display horizontally */
    }
    
    #menu-history-bar ul li {
        margin-right: 10px; /* Add space between menu items */
    }
    
    #menu-history-bar ul li a {
        display: block;
        padding: 6px 15px;
        text-decoration: none;
        color: #333;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }
    
    #menu-history-bar ul li a:hover {
        background-color: #e5e5e5;
    }
    
    #menu-history-bar ul li.active a {
        font-weight: bold;
    }
    
    #content-container {
        margin-top: 10px;
        background-color: #fff; 
        border-radius: 5px; 
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-right: 10px;
        height: 83%;
        border: 1px solid #ccc;
    }
    
    #allergy-table {
        width: 100%;
        border-radius: 5px; 
    }
    
    .row {
        display: flex;
        width: 100%;
    }
    
    .row.header {
        background-color: #f4f4f4;
        font-weight: bold;
    }
    
    .cell {
        padding: 10px;
        border-bottom: 1px solid #ccc;
        text-align: left;
    }
    
    .cell.allergen {
        flex-basis: 50%;
    }
    
    .cell.severity {
        flex-basis: 50%;
    }
    
    .row:nth-child(even) {
        background-color: #f2f2f2;
    }
    
    .row:hover {
        background-color: #eaeaea;
    }
        
    
    #edit-allergy {
        margin: 10px;
    }
    
    #edit-allergy-button, #save-allergy-button, #add-new-button, #cancel-allergy-button {
        color: black;
        cursor: pointer;

        padding: 5px;
        background-color: #D9D9D9;
    
        width: fit-content;
        height: max-content;
    
        text-align: center;
    
        margin-right: 20px;
    
        border-radius: 5px;
    }
    
    #edit-allergy-button:hover, #save-allergy-button:hover, #add-new-button:hover, #cancel-allergy-button:hover {
        font-weight: bold;
    }
    
</style>
{% endblock styles%}

{% block content %}

<div id="whole-screen">
    <div id="side-menu">
        <div id="all-info">
            <div id="user-info"> 
                <div id="image">
                    <img src="{% static 'logo-color.png' %}" id="display-photo">
                </div>
                <div id="information">
                    <div id="name">Jeonghan</div>
                    <div id="role"> General Practitioner</div>
                </div>
            </div>
            <div id="menu"> 
                <div id="a1"><i class="fas fa-tachometer-alt"></i> <a href="">Dashboard</a></div>
                <div id="a2"><i class="far fa-calendar-alt"></i> <a href="">Appointments</a></div>
                <div id="a3" style="font-weight: bold;"><i class="fas fa-user"></i> <a href="{% url 'patient_data_doctor_view' %}">Patients</a></div>
                <div id="a5"><i class="far fa-envelope"></i> <a href="">Message</a></div>
                <div id="a6"><i class="far fa-user-circle"></i> <a href="">Profile</a></div>
                <div id="a7"><i class="fas fa-cog"></i> <a href="">Settings</a></div>
            </div>
        </div>
    </div>

    <div id="other-side">
        <div id="title">
            <button id="backButton">Back</button>
        </div>
        <div id="menu-history-bar">
            <ul>
                <li><a id="medical-history-link" href="#">Past Medical/Surgical History</a></li>
                <li><a id="allergies-link" href="#">Allergies</a></li>
                <li><a id="immunization-link" href="#">Immunization</a></li>
                <li><a id="family-history-link" href="#">Family History</a></li>
                <li><a id="social-history-link" href="#">Social History</a></li>
            </ul>
        </div>
        <div id="content-container">
            
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get references to menu items
        const medicalHistoryLink = document.getElementById('medical-history-link');
        const allergiesLink = document.getElementById('allergies-link');
        const immunizationLink = document.getElementById('immunization-link');
        const familyHistoryLink = document.getElementById('family-history-link');
        const socialHistoryLink = document.getElementById('social-history-link');

        // Get reference to content container
        const contentContainer = document.getElementById('content-container');

        const backButton = document.getElementById('backButton');

        backButton.addEventListener('click', function() {
            window.history.back();
        });

        // Event listeners for menu items
        medicalHistoryLink.addEventListener('click', function(event) {
            event.preventDefault();
            contentContainer.innerHTML = 'Content for Medical History';
        });

        allergiesLink.addEventListener('click', function(event) {
            event.preventDefault();
            contentContainer.innerHTML = `
            <form method="post">
            {% csrf_token %}
            <div id="allergy-table">
                <div class="row header">
                    <div class="cell allergen">Allergen</div>
                    <div class="cell severity">Severity</div>
                </div>
                <div class="row">
                    <div class="cell allergen" name="allergen"></div>
                    <div class="cell severity">
                        <select name="severity">
                            <option value="" selected disabled>Select Severity</option>
                            <option value="Mild">Mild</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Severe">Severe</option>
                        </select>
                    </div>
                    
                </div>
            </div>
            <div id="edit-allergy">
                <button id="edit-allergy-button">Edit</button>
                <button id="save-allergy-button" name="saveAllergyButton" value={{ chosenPatientData_id }}>Save</button>
                <button id="cancel-allergy-button" style="display: none;">Cancel</button>
                <button id="add-new-button">Add New Row</button>
            </div>            
        </form>`;

            // Add event listeners
            const editAllergyButton = document.getElementById('edit-allergy-button');
            const cancelAllergyButton = document.getElementById('cancel-allergy-button');
            const addNewButton = document.getElementById('add-new-button');

            addNewButton.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent form submission
                            
                const newRow = document.createElement('div');
                newRow.classList.add('row');
                        
                newRow.innerHTML = `
                    <div class="cell allergen"></div>
                    <div class="cell severity">
                        <select name="severity">
                            <option value="" selected disabled>Select Severity</option>
                            <option value="Mild">Mild</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Severe">Severe</option>
                        </select>
                    </div>`;
                        
                const allergyTable = document.getElementById('allergy-table');
                allergyTable.appendChild(newRow);
            });
            
            editAllergyButton.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent form submission
                        
                // Show the Cancel button
                cancelAllergyButton.style.display = 'inline-block';
                            
                // Get all rows excluding the header row
                const rows = document.querySelectorAll('.row:not(.header)');
                            
                // Iterate over each row
                rows.forEach(row => {
                    // Get the severity cell of the row
                    const severityCell = row.querySelector('.cell.severity');
                            
                    // Replace text content with dropdown menu
                    severityCell.innerHTML = `
                        <select name="severity">
                            <option value="" selected disabled>Select Severity</option>
                            <option value="Mild">Mild</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Severe">Severe</option>
                        </select>`;
                });
            });
            
            cancelAllergyButton.addEventListener('click', function() {
                // Hide the Cancel button
                cancelAllergyButton.style.display = 'none';
                        
                // Get all rows excluding the header row
                const rows = document.querySelectorAll('.row:not(.header)');
                        
                // Iterate over each row
                rows.forEach(row => {
                    // Get the severity cell of the row
                    const severityCell = row.querySelector('.cell.severity');
                        
                    // Restore original text content
                    severityCell.innerHTML = severityCell.querySelector('select').value;
                });
            });
            
            
        });

        immunizationLink.addEventListener('click', function(event) {
            event.preventDefault();
            contentContainer.innerHTML = 'Content for Immunization';
        });

        familyHistoryLink.addEventListener('click', function(event) {
            event.preventDefault();
            contentContainer.innerHTML = 'Content for Family History';
        });

        socialHistoryLink.addEventListener('click', function(event) {
            event.preventDefault();
            contentContainer.innerHTML = 'Content for Social History';
        });
    });
</script>
{% endblock %}
