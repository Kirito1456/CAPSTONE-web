{% extends 'hmis/base.html' %}
{% load static %}

{% block title %}Appointment{% endblock %}

{% block styles %} 
<!-- Stylesheet for the program -->
<link rel="stylesheet" href="{% static 'css/style-appointmentss.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    .buttons_info {
        padding: 5px;
        margin: 5px; 
        border: none; 
        border-radius: 4px; 
        background-color: #ADB8CE; 
        color: black;
        cursor: pointer; 
        margin-right:10px;
    }
    
    .buttons_info:hover {
        font-weight: bold;
    }
</style>
{% endblock styles %}

{% block content %}
<div id="whole-screen">
    <div id="side-menu" style="background-color: #334a7c;">
        <div id="all-info">
            <div id="user-info"> 
                <div id = "image">
                    <img src="{% static 'logo-color.png' %}" id = "display-photo">
                </div>
                <div id="information">
                    {% for doctor_id, doctor_data in doctors.items %}
                        {% if doctor_data.uid == uid %}
                            <div id="name" style="font-size: 22px;"> {{ doctor_data.fname }} {{ doctor_data.lname }}</div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <div id="menu"> 
                <div id="a1"><i class="fas fa-tachometer-alt"></i> <a href="{% url 'DoctorDashboard' %}">Dashboard</a></div>
                <div id="a2" style="font-weight: bold;"> <i class="far fa-calendar-alt"></i> <a href="{% url 'AppointmentUpcoming' %}">Appointments</a></div>
                <div id="a3"><i class="fas fa-user"></i> <a href="{% url 'patient_data_doctor_view' %}">Patients</a></div>
                
                <div id="a4"><i class="fas fa-sign-out-alt"></i> <a href="{% url 'logout' %}"> Logout</a></div>
            </div>
        </div>
    </div>
    <div id="appointment-screen">
        <div class="apt-header-btns">
            <div class="apt-header-left">
                <div id="apt-btn"><a href="AppointmentCalendar.html">Calendar</a></div>
                <div id="apt-btn" style="font-weight: bold;"><a href="AppointmentUpcoming.html">Upcoming</a></div>
                <div id="apt-btn"><a href="AppointmentPast.html">Past</a></div>
                <div id="apt-btn"><a href="AppointmentScheduling.html">Schedule</a></div>
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search...">
                <button id="searchButton">Search</button>
            </div>
        </div>
        <table class="clients_table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Name</th>
                    <th>Visit Type</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% if appointments %}
                    {% for appointment_id, appointment_data in appointments.items %}
                    <tr>
                        <form method="post" >
                            {% csrf_token %}
                            <input type="hidden" name="selected_appointment_date" value="{{ appointment_data.appointmentDate }}">
                        
                            <td><label class="accountT_lbl" name="selected_appointment_date">{{ appointment_data.appointmentDate }}</label></td>
                        </form>
                            <td><label class="accountT_lbl">{{ appointment_data.appointmentTime }}</label></td>
                        {% for patient_id, patient_data in patients.items %}
                            {% if patient_data.uid == appointment_data.patientName %}
                                <td><label class="accountT_lbl"><a href="{% url 'patient_personal_information_inpatient' %}?chosenPatient={{patient_data.uid}}&appointmentID={{appointment_id}}">{{ patient_data.lname }}, {{ patient_data.fname }}</a></label></td>
                            {% endif %}
                        {% endfor %}
                        <td><label class="accountT_lbl">{{ appointment_data.appointmentVisitType }}</label></td>
                        <td><label class="accountT_lbl"><a href="#" class="details-link" >Click for More Details</a></label>
                        {% for patient_id, patient_data in patients.items %}
                            {% if appointment_data.patientName == patient_data.uid  %}
                                <div class="details-container" style="display: none;">
                                    <div class="detail-wrapper">
                                        <div class="detailname" style="font-weight: bold;">E-mail: </div>
                                        <div class="detailvalue">{{ patient_data.email }}</div>
                                    </div>
                                    <div class="detail-wrapper">
                                        <div class="detailname" style="font-weight: bold;">Phone Number: </div>
                                        <div class="detailvalue">{{ patient_data.cnumber }}</div>
                                    </div>
                                    <div class="detail-wrapper">
                                        <div class="detailname" style="font-weight: bold;">Location: </div>
                                        <div class="detailvalue">{{ patient_data.address}}</div>
                                    </div>
                                    <div class="button-container">
                                        <button class="reschedule-button" onclick="openModal('{{ appointment_id }}')">Reschedule</button>
                                        <form action="{% url 'delete_appointment' %}" method="post">
                                            {% csrf_token %}
                                            <button type="submit" class="cancel-button" onclick="cancelAppointment()" name='cancel' value={{ appointment_id }}>Cancel Appointment</button>
                                        </form>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                        </td>
                        
                            
                        <div id="myModal" class="modal">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <h2>Reschedule Appointment</h2>
                                <form id="reschedule-form{{ appointment_id }}" method="POST" action="{% url 'update_appointment' %}">
                                    {% csrf_token %}
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <label for="suggested-date" style="margin-right: 10px;">Suggested Schedule:</label>
                                        <input type="text" id="selected_appointment_date" name="selected_appointment_date" value={{ next_available_date_str }} style="font-size: 14px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        </input>
                                    </div>
                                    <label for="suggested-time">Suggested Time:</label>
                                    <select id="new_appointment_time" name="new_appointment_time" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        {% for time_slot in time_slots %}
                                            <option value="{{ time_slot }}">{{ time_slot }}</option>
                                        {% endfor %}
                                    </select><br>
                                    <button type="submit" class="buttons_info" id="appID" name="appID" value="{{ appointment_id }}">Submit</button>
                                </form>
                            </div>
                        </div>
                    </tr>
                {% endfor %}
            {% else %}
            <td colspan="5">No upcoming appointments!</td>
            {% endif %}

            </tbody>
        </table>
    </div>
</div>

<script src="{% static 'js/appointment.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('appID').addEventListener('click', function () {
            alert('Appointment rescheduled successfully!');
        });
    });
</script>

{% endblock %}
