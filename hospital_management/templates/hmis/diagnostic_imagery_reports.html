{%load static%}
<title>{% block title %}Patient Data{% endblock %}</title>

{% block styles%} 
<link rel="stylesheet" href="{% static 'css/imagery-reports.css' %}">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    #head-corner, #head{
        float: left;
        font-size: 18;
        font-weight: bold;
        padding: 10px;
        background-color: #5c7c89;
        text-align: center;
        color: white;
    }

    #info, #image-report{
        display: flex;
        flex-direction: column;
    }
    
    #imagery-tests{
        background-color: #E9E9E9;
    }
    
    #imagery-reports-list{
        display: flex;
    
        justify-content: center;
        align-items: center;
        align-content: center;
    
        flex-direction: column;
    }
    
    #reports-table{
        margin-top: 10;
        margin-bottom: 10;
    
        width: 95%;
    
        text-align: center;
    
        table-layout:fixed;
    
        background-color: #D9D9D9;
    
        font-size: 15;
    }
    
    th.date{
        width: 15%
    }
    
    th.type{
        width: 15%;
    }
    
    th.report{
        width: 30%;
    }
    
    th.note{
        width: 52%;
    }
    
    #download{
        display: flex;
        flex-direction: column;
    
        align-content: center;
        align-items: center;
    
        padding-bottom: 10;
    
        font-size: 14;
    }
    
    #download-imagery{
        background-color: #85AA9B;
    
        border-radius: 5%;
    
        margin-top: 5;
    
        width: 50%;
        padding: 5;
    }
    
    #download-disposition{
        background-color: #85AA9B;
    
        border-radius: 5%;
    
        margin-top: 5;
    
        width: 85%;
        padding: 5;
    }
    
    td{
        margin-top: 10;
        margin-bottom: 10;
    }
    
    #notes{
        display: flex;
        flex-direction: row;
        justify-content: space-around;
    
        padding: 5;
        padding-left: 10;
        padding-right: 10;
    }
    
    #doctor-notes{
        display: flex;
        justify-content: flex-start;
        word-wrap: break-word;
    
        width: 70%;
        text-align: justify;
    }
    
    #add-notes{
        display: flex;
        justify-content: flex-end;
    
        justify-content: center;
        align-items: center;
    
        background-color: #85AA9B;
        padding: 5;
        padding-left: 10;
        padding-right: 10;
    
        border-radius: 5%;
    
        width: 15%;
        font-size: 14;
    }
    #reports-container {
        display: flex;
        flex-direction: column;
        border: 1px solid #ccc;
    }
    
    .report-item {
        display: flex;
        border-bottom: 1px solid #ccc;
    }
    
    .report-item.label {
        font-weight: bold;
    }
    
    .date, .type, .report, .note {
        padding: 8px;
    }
    
    .date, .type, .report {
        flex: 1;
    }
    
    .note {
        flex: 2;
    }
    
    #download {
        display: flex;
        justify-content: space-between;
    }
    
    #download a {
        text-decoration: none;
        color: blue;
    }
    
    #download a:hover {
        text-decoration: underline;
    }
    
    .add-notes {
        margin-left: auto;
    }
    
    
</style>
{% endblock styles%}

{% block content %}
        <div id = "whole-screen">
            <div id = "side-menu">
                <div id = "all-info">
                    <div id = "user-info"> 
                        <div id = "image">
                            <img src="{% static 'logo-color.png' %}" id = "display-photo">
                        </div>
                        <div id = "information">
                            <div id = "name"> Jeonghan </div>
                            <div id = "role"> General Practitioner</div>
                        </div>
                    </div>
                    <div id="menu"> 
                        <div id="a1"><i class="fas fa-tachometer-alt"></i> <a href="">Dashboard</a></div>
                        <div id="a2"><i class="far fa-calendar-alt"></i> <a href="">Appointments</a></div>
                        <div id="a3" style="font-weight: bold;"><i class="fas fa-user"></i> <a href="{% url 'patient_data_doctor_view' %}">Patients</a></div>
                        <div id="a5"><i class="far fa-envelope"></i> <a href="">Message</a></div>
                        <div id="a6"><i class="far fa-user-circle"></i> <a href="">Profile</a></div>
                        <div id="a7"><i class="fas fa-cog"></i> <a href="">Settings</a></div>
                    </div>
                </div>
            </div>
            <div id = "other-side">
                <div id = "title">
                    <div id = "left">
                        <button id="backButton">Back</button>
                    </div>
                </div>
                <div id = "imagery-reports">
                    <div id = "image-report">
                        <div id = "head-corner">Results</div>
                        <div id = "imagery-tests">
    
                            <div id="reports-container">
                                <div class="report-item label">
                                    <div class="date">Date</div>
                                    <div class="type">Imagery Type</div>
                                    <div class="report">Report</div>
                                </div>
                                {% for submittedTest_id, submittedTest_data in submittedTest.items %}
                                    {% if submittedTest_id == chosenPatient %}
                                        {% for submitted_id, submitted_data in submittedTest_data.items %}
                                            <div class="report-item">
                                                <div class="date">{{ submitted_data.date }}</div>
                                                <div class="type">{{ submitted_data.testRequestKey }}</div>
                                                <div class="report">
                                                    <a href="{{ submitted_data.downloadURL }}" class="view-image" style="color: blue;">View Image</a>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.view-image').click(function(event) {
            event.preventDefault(); // Prevent default behavior of the link
            var imageUrl = $(this).attr('href');
            window.open(imageUrl, '_blank'); // Open the image in a new tab
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const backButton = document.getElementById('backButton');

        backButton.addEventListener('click', function() {
            window.history.back();
        });
    });
    // Get the Add Notes link and Doctor's Notes div
var addNotesLink = document.getElementById("add-doctor-notes");
var doctorNotesDiv = document.getElementById("doctor-notes");

// Add an event listener to the Add Notes link
addNotesLink.addEventListener("click", function(event) {
    event.preventDefault(); // Prevent the default link behavior
    
    // Replace the Doctor's Notes div with an input field
    var inputField = document.createElement("input");
    inputField.setAttribute("type", "text");
    inputField.setAttribute("id", "input-doctor-notes");
    inputField.setAttribute("placeholder", "Type doctor's notes here");
    
    // Replace the Doctor's Notes div with the input field
    doctorNotesDiv.parentNode.replaceChild(inputField, doctorNotesDiv);
    
    // Focus on the input field for immediate typing
    inputField.focus();
});
</script>
{% endblock %}