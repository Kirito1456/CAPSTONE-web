{%load static%}
<title>{% block title %}Patient Data{% endblock %}</title>

{% block styles%} 
<!-- <link rel="stylesheet" href="{% static 'css/patient_medication_style.css' %}"> -->
<link rel="stylesheet" href="{% static 'css/view_treatment_plan_style.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-***" crossorigin="anonymous" />

{% endblock styles%}

{% block content %}
<div class = "whole-screen">
    <div id = "side-menu">
        <div id = "all-info">
            <div id = "user-info"> 
                <div id = "image">
                    <img src="{% static 'hannie.jpg' %}" id = "display-photo">
                </div>
                <div id = "information">
                    <div id = "name"> Jeonghan </div>
                    <div id = "role"> General Practitioner</div>
                </div>
            </div>
            <div id = "menu"> 
                <div id = "a1"><a href="">Dashboard</a></div>
                <div id = "a2"><a href="">Appointments</a></div>
                <div id = "a3"><a href="{% url 'patient_data_doctor_view' %}">Patients</a></div>
                <div id = "a4" style="font-weight: bold;"><a href="{% url 'patient_medication_doctor' %}">Medications</a></div>
                <div id = "a5"><a href="">Message</a></div>
                <div id = "a6"><a href="">Profile</a></div>
                <div id = "a7"><a href="">Settings</a></div>
            </div>
        </div>
    </div>
    <div id = "other-information">
        <div id = "title">
            <button id="backButton">Back</button>
        </div>
        <div id = "treatment-plan">
            <div id = "patient-information">
                <div id = "first">
                    <div id = "fname-label">Name of Patient</div>
                    <div id="fname">{{ fname }} {{ lname }}</div>
                </div>
                <div id = "gender">
                    <div id = "gender-label">Gender</div>
                    <div id = "gender-view">{{ gender }}</div>
                </div>
                <div id = "bday">
                    <div id = "bday-label">Date of Birth</div>
                    <div id = "birthday-view">{{ bday }}</div>
                </div>
                <div id = "age">
                    <div id = "age-label">Age</div>
                    <div id = "age-view"></div>
                </div>   
            </div>
            <hr>
            <div id="medications-container">
                <div id="head">Medications List</div>
                
                <div id="medication-list-container">
                    <div id="table-header" style="font-size: 14px;">
                        <div style="flex: 1; text-align: center;">Date</div>
                        <div style="flex: 1; text-align: center;">Prescripted Medication</div>
                        <div style="flex: 1; text-align: center;">Additional Remarks</div>
                    </div>
                    <div id="table-body" style="font-size: 14px;">
                        {% for po_data in prescriptionsorders.items %}
                        <div style="flex: 1; text-align: center;"><a href="{% url 'view_treatment_plan' fname=fname lname=lname gender=gender bday=bday %}">{{po_data.todaydate}}</a></div>
                        <div style="flex: 1; text-align: center;">Medicine Name</div>
                        <div style="flex: 1; text-align: center;">Additional Remarks</div>
                        {% endfor %}
                    </div>
                </div>
                
            </div>

            <div class="pagination">
                <a href="#">&laquo;</a>
                <a href="#" class="active">1</a>
                <a href="#">&raquo;</a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var birthdayString = document.getElementById("birthday-view").innerText;
        var birthday = new Date(birthdayString);
        var today = new Date();
        var ageYear = today.getFullYear() - birthday.getFullYear();
        var ageMonth = today.getMonth() - birthday.getMonth();
        const backButton = document.getElementById('backButton');
        
        // Adjust age months if negative
        if (ageMonth < 0 || (ageMonth === 0 && today.getDate() < birthday.getDate())) {
            ageYear--;
            ageMonth += 12;
        }

        document.getElementById("age-view").innerText = ageYear + " years and " + ageMonth + " months";
        backButton.addEventListener('click', function() {
            window.history.back();
        });
    });
</script>

{% endblock %}